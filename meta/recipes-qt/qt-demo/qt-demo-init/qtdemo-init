#!/bin/sh

set -e

if [ -f /usr/bin/qtdemo ]; then
	QTDEMO="qtdemo > /var/log/Xsession.log 2> &1"
else
	QTDEMO="qtdemoE -qws"
fi

case "$1" in
  start)
	echo "Starting qtdemo"
	if [ -f /etc/profile.d/tslib.sh ]; then
<<<<<<< HEAD
		. /etc/profile.d/tslib.sh
=======
		source /etc/profile.d/tslib.sh
>>>>>>> cb9658cf8ab6cf009030dcadde9dc6c54b72bddc
	fi
	if [ -e "$TSLIB_TSDEVICE" ]; then
		if [ ! -f /etc/pointercal ]; then
			/usr/bin/ts_calibrate
		fi
<<<<<<< HEAD
		if [ "$QTDEMO" = qtdemo ]; then
=======
		if [ "$QTDEMO" == qtdemo ]; then
>>>>>>> cb9658cf8ab6cf009030dcadde9dc6c54b72bddc
			Xorg &
			export DISPLAY=:0
			$QTDEMO &
		else
			QWS_MOUSE_PROTO=tslib:$TSLIB_TSDEVICE $QTDEMO &
		fi
	else
<<<<<<< HEAD
		if [ "$QTDEMO" = qtdemo ]; then
=======
		if [ "$QTDEMO" == qtdemo ]; then
>>>>>>> cb9658cf8ab6cf009030dcadde9dc6c54b72bddc
			Xorg &
			export DISPLAY=:0
		fi
		$QTDEMO &
	fi
	;;
  stop)
	echo "Stopping qtdemo"
<<<<<<< HEAD
	if [ "$QTDEMO" = qtdemo ]; then
=======
	if [ "$QTDEMO" == qtdemo ]; then
>>>>>>> cb9658cf8ab6cf009030dcadde9dc6c54b72bddc
		killall Xorg
		killall qtdemo
	else
		killall qtdemoE
	fi
	;;
  restart)
	$0 stop
	$0 start
	;;
  *)
	echo "usage: $0 { start | stop | restart }" >&2
	exit 1
	;;
esac

exit 0
