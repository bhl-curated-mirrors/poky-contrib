From 2bde78f2d94065ced26376ddc5b038c941e2ef90 Mon Sep 17 00:00:00 2001
From: Chen Qi <Qi.Chen@windriver.com>
Date: Fri, 23 Feb 2018 10:40:39 +0800
Subject: [PATCH 03/32] use lnr wrapper instead of looking for --relative
 option for ln

Remove file manually to avoid the 'File Exists' error when creating
symlink. This is because the original 'ln' command uses '-f' option.

Upstream-Status: Inappropriate [OE-Specific]

Signed-off-by: Khem Raj <raj.khem@gmail.com>
Signed-off-by: Chen Qi <Qi.Chen@windriver.com>
---
 meson.build                 | 4 ----
 tools/meson-make-symlink.sh | 3 ++-
 units/meson-add-wants.sh    | 7 ++++++-
 3 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/meson.build b/meson.build
index ddc061c12..4b5ef376f 100644
--- a/meson.build
+++ b/meson.build
@@ -530,10 +530,6 @@ foreach prog : progs
         substs.set(name, path)
 endforeach
 
-if run_command('ln', '--relative', '--help').returncode() != 0
-        error('ln does not support --relative')
-endif
-
 ############################################################
 
 gperf = find_program('gperf')
diff --git a/tools/meson-make-symlink.sh b/tools/meson-make-symlink.sh
index 47a5e70ae..271edf9bc 100755
--- a/tools/meson-make-symlink.sh
+++ b/tools/meson-make-symlink.sh
@@ -7,5 +7,6 @@ mkdir -vp "$(dirname "${DESTDIR:-}$2")"
 if [ "$(dirname $1)" = . ]; then
         ln -vfs -T "$1" "${DESTDIR:-}$2"
 else
-        ln -vfs -T --relative "${DESTDIR:-}$1" "${DESTDIR:-}$2"
+        rm -f "${DESTDIR:-}$2"
+        lnr "${DESTDIR:-}$1" "${DESTDIR:-}$2"
 fi
diff --git a/units/meson-add-wants.sh b/units/meson-add-wants.sh
index dfd287e17..11d30c9b2 100755
--- a/units/meson-add-wants.sh
+++ b/units/meson-add-wants.sh
@@ -24,4 +24,9 @@ case "$target" in
                 ;;
 esac
 
-ln -vfs --relative "$unitpath" "$dir"
+if [ -d "$dir" ]; then
+        rm -f "$dir/$unit"
+        lnr "$unitpath" "$dir/$unit"
+else
+        lnr "$unitpath" "$dir"
+fi
-- 
2.11.0

