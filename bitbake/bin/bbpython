#! /bin/sh
#
# Run python from bitbake's virtual environment, preparing the environment if
# it is missing or has changed
#
# Copyright (C) 2021 Joshua Watt <JPEWhacker@gmail.com>
#
# SPDX-License-Identifier: GPL-2.0-only

BITBAKEDIR="$(dirname "$0")/../"

if [ -z "$BITBAKE_VENV" ]; then
    BITBAKE_VENV="$BITBAKEDIR/venv"
fi

if [ -z "$VIRTUAL_ENV" ]; then
    bbvenv update --venv=$BITBAKE_VENV || exit $?
    . $BITBAKE_VENV/bin/activate
fi

exec python "$@"
