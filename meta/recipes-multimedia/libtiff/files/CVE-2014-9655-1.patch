From 24a2eee78bb057acb2c3992acd002654c1747718 Mon Sep 17 00:00:00 2001
From: erouault <erouault>
Date: Wed, 24 Dec 2014 16:57:18 +0000
Subject: [PATCH] * libtiff/tif_getimage.c: avoid divide by zero on invalid
 YCbCr subsampling. http://bugzilla.maptools.org/show_bug.cgi?id=2235

Upstream-Status: Backport

https://github.com/vadz/libtiff/commit/40a5955cbf0df62b1f9e9bd7d9657b0070725d19#diff-8267b6b5121b27393df8c9734578a8ae

CVE: CVE-2014-9655 #2

Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 ChangeLog              | 5 +++++
 libtiff/tif_getimage.c | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/libtiff/tif_getimage.c b/libtiff/tif_getimage.c
index 396ad08..417ac7b 100644
--- a/libtiff/tif_getimage.c
+++ b/libtiff/tif_getimage.c
@@ -875,6 +875,10 @@ gtStripContig(TIFFRGBAImage* img, uint32* raster, uint32 w, uint32 h)
 
 	TIFFGetFieldDefaulted(tif, TIFFTAG_ROWSPERSTRIP, &rowsperstrip);
 	TIFFGetFieldDefaulted(tif, TIFFTAG_YCBCRSUBSAMPLING, &subsamplinghor, &subsamplingver);
+	if( subsamplingver == 0 ) {
+		TIFFErrorExt(tif->tif_clientdata, TIFFFileName(tif), "Invalid vertical YCbCr subsampling");
+		return (0);
+	}
 	scanline = TIFFScanlineSize(tif);
 	fromskew = (w < imagewidth ? imagewidth - w : 0);
 	for (row = 0; row < h; row += nrow)
